# Serverless chatbot

Chatbot is an application which brings to you the use of managing your time. With it, you can schedule events and add tasks to your Google account. It brings you information about cultural events near you and it will ensure that you know what to wear for your outdoor training.

This project is created using [SAM](https://aws.amazon.com/serverless/sam/) framework and uses Python as its runtime. Additionally, using [GitHub Actions](https://github.com/gg-mike/chatbot/actions) provides CI/CD.

`NOTE`: [black](https://github.com/psf/black) is used for code formatting (use command `black -l 100 .` or `python3 -m black -l 100 .` before committing)

## Local development

### Requirements

To use the SAM CLI, you need the following tools.

* SAM CLI - [Install the SAM CLI](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html)
* [Python 3 installed](https://www.python.org/downloads/)
* Docker - [Install Docker community edition](https://hub.docker.com/search/?type=edition&offering=community)

### Build

To build application run the following in your shell (UNIX based system):

```bash
python scripts/generate_lambda_sources.py
sam build --use-container
```

#### Using dependencies to build Lambda function
File `dependencies.yml` allows you to define the dependency structure for your functions and streamlines the process of generating sources. This file requires to keys to be present:
 - `globals` - defines global dependencies for every lambda
 - `lambda` - lambda specific dependencies
There are also 2 keys which cannot be used in lambda name:
 - `_req` - defines requirements function
 - `_dep` - defines common files dependencies function

### Local testing

Test a single function by invoking it directly with a test event. An event is a JSON document that represents the input that the function receives from the event source. Test events are included in the `events` folder in this project.

Run functions locally and invoke them with the `sam local invoke` command.

```bash
chatbot$ sam local invoke HelloApi --event events/event.json
```

The SAM CLI can also emulate your application's API. Use the `sam local start-api` to run the API locally on port 3000.

```bash
chatbot$ sam local start-api
chatbot$ curl http://localhost:3000/
```

### Fetch, tail, and filter Lambda function logs

To simplify troubleshooting, SAM CLI has a command called `sam logs`. `sam logs` lets you fetch logs generated by your deployed Lambda function from the command line. In addition to printing the logs on the terminal, this command has several nifty features to help you quickly find the bug.

`NOTE`: This command works for all AWS Lambda functions; not just the ones you deploy using SAM.

```bash
chatbot$ sam logs -n HelloApi --stack-name chatbot --tail
```

More information on logging you can find [here](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-logging.html).
